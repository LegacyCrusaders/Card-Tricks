<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Prediction</title>
<style>
body {
  margin: 0;
  height: 100vh;
  background: black;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  font-family: sans-serif;
  text-align: center;
}
</style>
</head>

<body>
<div id="msg">Tap to begin</div>

<script>
let armed = false;
let faceDown = false;
let locked = false;
let lastTime, lastBeta, lastGamma;

const SPEED = 25;

document.body.onclick = async () => {
  if (armed) return;

  if (typeof DeviceMotionEvent !== "undefined" &&
      typeof DeviceMotionEvent.requestPermission === "function") {
    const p = await DeviceMotionEvent.requestPermission();
    if (p !== "granted") return;
  }

  armed = true;
  document.getElementById("msg").innerText = "Set phone face down";
  window.addEventListener("deviceorientation", handle);
};

function handle(e) {
  if (!armed || locked) return;

  const beta = e.beta;
  const gamma = e.gamma;
  const now = Date.now();

  if (!faceDown) {
    if (Math.abs(beta) < 10 && Math.abs(gamma) < 10) {
      faceDown = true;
      document.getElementById("msg").innerText = "Lift the phone";
      lastTime = now;
      lastBeta = beta;
      lastGamma = gamma;
    }
    return;
  }

  const dt = (now - lastTime) / 1000;
  const speed =
    Math.abs(beta - lastBeta) / dt +
    Math.abs(gamma - lastGamma) / dt;

  if (Math.abs(beta) > 45 || Math.abs(gamma) > 45) {
    locked = true;
    reveal(beta, gamma, speed);
  }

  lastTime = now;
  lastBeta = beta;
  lastGamma = gamma;
}

function reveal(beta, gamma, speed) {
  const fast = speed > SPEED;
  let n = "?";

  if (beta < -45) n = fast ? 2 : 1;
  else if (gamma > 45) n = fast ? 4 : 3;
  else if (beta > 45) n = fast ? 6 : 5;
  else if (gamma < -45) n = fast ? 8 : 7;

  document.getElementById("msg").innerText =
    "My prediction is:\n" + n;
}
</script>
</body>
</html>
