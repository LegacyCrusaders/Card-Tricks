<!-- TIME LOOP PHONE â€“ VERSION 4 -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Phone</title>

<style>
html, body { margin:0; padding:0; height:100%; background:black; font-family:-apple-system,BlinkMacSystemFont,sans-serif; color:white; overflow:hidden;}
.screen{position:fixed; inset:0; display:none; justify-content:center; align-items:center; flex-direction:column;}
.active{display:flex;}
.avatar{width:90px;height:90px;border-radius:50%;background:#555;margin-bottom:15px;}
h1{margin:6px 0;font-size:26px;}
p{opacity:0.7;}
.buttons{position:absolute;bottom:40px;width:100%;display:flex;justify-content:space-around;}
.btn{width:72px;height:72px;border-radius:50%;display:flex;align-items:center;justify-content:center;}
.green{background:#2ecc71;color:black;}
.red{background:#e74c3c;}
.controls{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-top:40px;text-align:center;font-size:14px;}
.log{padding:20px;align-items:flex-start;}
.log-item{width:100%;padding:14px 0;border-bottom:1px solid #333;}
.log-item span{float:right;opacity:0.6;}
.log-item.callable{cursor:pointer;}
</style>
</head>

<body>

<!-- START -->
<div id="start" class="screen active">
  <h1>Tap to Begin</h1>
  <p>Version 4</p>
</div>

<!-- ARMED (blank) -->
<div id="armed" class="screen"></div>

<!-- INCOMING -->
<div id="incoming" class="screen">
  <div class="avatar"></div>
  <h1 id="incomingName">Future Me</h1>
  <p>Incoming Call</p>
  <div class="buttons">
    <div class="btn red" onclick="endToLog()">Decline</div>
    <div class="btn green" onclick="answerIncoming()">Answer</div>
  </div>
</div>

<!-- CONNECTED -->
<div id="call" class="screen">
  <div class="avatar"></div>
  <h1 id="callName"></h1>
  <p id="timer">00:00</p>

  <div class="controls">
    <div>Mute</div><div>Keypad</div><div>Speaker</div>
    <div>Add</div><div>FaceTime</div><div>Contacts</div>
  </div>

  <div class="buttons">
    <div class="btn red" onclick="hangUp()">End</div>
  </div>
</div>

<!-- LOG -->
<div id="log" class="screen log">
  <h1>Recents</h1>
  <div id="logItems"></div>
</div>

<script>
let mode="idle";
let faceDown=false;
let timerInt;
let seconds=0;
let currentCaller="";

// Initial log
let log=[
  {name:"Future Me", time:"now", callable:false},
  {name:"Mom", time:"Yesterday", callable:false},
  {name:"Jordan", time:"9:14 AM", callable:false}
];

// Utility: show screen
function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// Tap to begin
async function start(){
  if(!document.fullscreenElement){await document.documentElement.requestFullscreen();}
  if('wakeLock' in navigator){try{await navigator.wakeLock.request('screen');}catch{}}
  show('armed');
  mode="armed";
}
document.getElementById('start').onclick=start;

// Flip detection
window.addEventListener('deviceorientation', e=>{
  if(mode!=="armed") return;
  if(e.beta>150||e.beta<-150){faceDown=true;}
  else if(faceDown){
    faceDown=false;
    mode="locked";
    setTimeout(()=>{
      show('incoming');
      navigator.vibrate([200,200,200]);
    },1000);
  }
});

// Answer incoming
function answerIncoming(){
  startCall("Future Me");
}

// General call starter
function startCall(caller){
  clearInterval(timerInt);
  seconds=0;
  currentCaller=caller;
  document.getElementById('callName').innerText=caller;
  document.getElementById('timer').innerText='00:00';
  show('call');
  timerInt=setInterval(()=>{
    seconds++;
    let m=String(Math.floor(seconds/60)).padStart(2,'0');
    let s=String(seconds%60).padStart(2,'0');
    document.getElementById('timer').innerText=`${m}:${s}`;
  },1000);
}

// Hang up
function hangUp(){
  clearInterval(timerInt);
  if(mode==="locked" || mode==="call"){
    // First call ends, add Past Me at bottom
    if(currentCaller==="Future Me" && !log.find(x=>x.name==="Past Me")){
      log.push({name:"Past Me", time:"now", callable:true});
    }
  }
  // Update mode for next interaction
  mode="log";
  renderLog();
  show('log');
}

// Return to log without answering
function endToLog(){ renderLog(); show('log'); mode="log"; }

// Render log
function renderLog(){
  const el=document.getElementById('logItems');
  el.innerHTML="";
  // Sort: most recent first for display
  let displayLog = [...log];
  // First log: Future Me at top, Past Me at bottom
  // Second log: Past Me at top, Future Me below
  if(log.find(x=>x.name==="Past Me") && mode==="log"){
    // Swap Past Me to top
    displayLog = log.filter(x=>x.name==="Past Me").concat(log.filter(x=>x.name!=="Past Me"));
  } else {
    // normal ordering
    displayLog = log;
  }
  displayLog.forEach(item=>{
    const d=document.createElement('div');
    d.className="log-item"+(item.callable?" callable":"");
    d.innerHTML=`${item.name}<span>${item.time}</span>`;
    if(item.callable){ d.onclick=callPast; }
    el.appendChild(d);
  });
}

// Call Past Me
function callPast(){
  currentCaller="Past Me";
  startCall("Past Me");
  mode="calling";
}

// Initial render
renderLog();
</script>

</body>
</html>
