<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Card App</title>

<style>
  body {
    margin: 0;
    background: black;
    color: white;
    font-family: system-ui, -apple-system;
    height: 100vh;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    touch-action: none;
  }

  .app {
    width: 100%;
    max-width: 390px;
    text-align: center;
  }

  .scene {
    width: 65vw;
    max-width: 190px;
    aspect-ratio: 7 / 10;
    perspective: 900px;
    margin: 30px auto;
  }

  .card {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.55s ease;
  }

  .card.face-up {
    transform: rotateY(180deg);
  }

  .card-face {
    position: absolute;
    inset: 0;
    border-radius: 14px;
    backface-visibility: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 3rem;
    border: 2px solid #222;
  }

  .front {
    background: white;
    color: black;
    transform: rotateY(180deg);
  }

  .front.red {
    color: #b91c1c;
  }

  .back {
    background:
      repeating-linear-gradient(
        45deg,
        #999,
        #999 10px,
        #b91c1c 10px,
        #b91c1c 20px
      );
  }
</style>
</head>
<body>

<div class="app">
  <div class="scene">
    <div id="card" class="card">
      <div id="front" class="card-face front"></div>
      <div class="card-face back"></div>
    </div>
  </div>
</div>

<script>
/* Wake Lock */
if ("wakeLock" in navigator) {
  navigator.wakeLock.request("screen").catch(()=>{});
}

/* Card data */
const valueGrid = [
  ["A","2","3"],
  ["4","5","6"],
  ["7","8","9"],
  ["10","J","Q"],
  ["K","RANDOM","JOKER"]
];

const suits = {
  up:    { symbol:"‚ô£", color:"black" },
  right: { symbol:"‚ô•", color:"red"   },
  down:  { symbol:"‚ô†", color:"black" },
  left:  { symbol:"‚ô¶", color:"red"   }
};

let chosenSuit = null;
let faceUp = false;
let currentCard = null;

/* Touch tracking */
let startX = 0;
let startY = 0;
let suitLocked = false;

const card = document.getElementById("card");
const front = document.getElementById("front");

/* Capture drag for suit */
document.body.addEventListener("touchstart", e => {
  const t = e.touches[0];
  startX = t.clientX;
  startY = t.clientY;
});

document.body.addEventListener("touchend", e => {
  if (suitLocked) return;

  const t = e.changedTouches[0];
  const dx = t.clientX - startX;
  const dy = t.clientY - startY;

  if (Math.abs(dx) < 20 && Math.abs(dy) < 20) return;

  if (Math.abs(dx) > Math.abs(dy)) {
    chosenSuit = dx > 0 ? suits.right : suits.left;
  } else {
    chosenSuit = dy < 0 ? suits.up : suits.down;
  }

  suitLocked = true;
});

/* Tap card = select value + flip */
card.addEventListener("click", e => {
  if (faceUp) {
    faceUp = false;
    updateCard();
    return;
  }

  const rect = card.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  const col = Math.floor(x / (rect.width / 3));
  const row = Math.floor(y / (rect.height / 5));

  let value = valueGrid[row]?.[col];
  if (!value) return;

  if (value === "RANDOM") {
    const allValues = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
    value = allValues[Math.floor(Math.random()*allValues.length)];
  }

  if (value === "JOKER") {
    currentCard = { label:"üÉè", color:"black" };
  } else {
    if (!chosenSuit) return;
    currentCard = {
      label: value + chosenSuit.symbol,
      color: chosenSuit.color
    };
  }

  faceUp = true;
  updateCard();
});

/* Render */
function updateCard() {
  if (faceUp && currentCard) {
    front.textContent = currentCard.label;
    front.className = "card-face front " + (currentCard.color === "red" ? "red" : "");
  } else {
    front.textContent = "";
  }
  card.classList.toggle("face-up", faceUp);
}
</script>

</body>
</html>
