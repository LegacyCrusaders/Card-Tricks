<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Card App</title>
<style>
body {
  margin:0;
  background:black;
  font-family:system-ui,-apple-system;
  height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  overflow:hidden;
  touch-action:none;
}

.scene {
  width:80vw;
  max-width:300px;
  aspect-ratio:7/10;
  perspective:900px;
  padding:30px; /* padding for drag zones */
  box-sizing:border-box;
}

.card {
  width:100%;
  height:100%;
  position:relative;
  transform-style:preserve-3d;
  transition: transform 0.55s ease;
  border-radius:14px;
}

.card.face-up {
  transform: rotateY(180deg);
}

.card-face {
  position:absolute;
  inset:0;
  border-radius:14px;
  backface-visibility:hidden;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:3.5rem;
  border:2px solid #222;
}

.front {
  background:white;
  color:black;
  transform:rotateY(180deg);
}

.front.red { color:#b91c1c; }

.back {
  background:repeating-linear-gradient(
      45deg,
      #999,#999 10px,
      #b91c1c 10px,#b91c1c 20px
    );
}

.controls {
  display:flex;
  gap:12px;
  margin-top:12px;
}

button {
  background:#111;
  color:white;
  border:1px solid #333;
  padding:10px 12px;
  border-radius:10px;
  font-size:16px;
  cursor:pointer;
}

.modal {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.85);
  display:none;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  z-index:10;
  padding:20px;
}

.modal.active { display:flex; }

.modal .btn-row {
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:6px;
  margin:6px 0;
}

.modal button {
  flex:1 1 20%;
  min-width:40px;
}

.selected {
  border:2px solid #fff;
}
</style>
</head>
<body>

<div class="scene" id="card-area">
  <div id="card" class="card">
    <div id="front" class="card-face front"></div>
    <div class="card-face back"></div>
  </div>
</div>

<div class="controls">
  <button id="shuffleBtn">Shuffle</button>
  <button id="chooseBtn">Choose</button>
</div>

<div id="modal" class="modal">
  <div class="btn-row" id="value-buttons"></div>
  <div class="btn-row" id="suit-buttons"></div>
  <button id="doneBtn">Done</button>
</div>

<script>
// Wake lock
if("wakeLock" in navigator) navigator.wakeLock.request("screen").catch(()=>{});

// Card setup
const valueGrid=[["A","2","3"],["4","5","6"],["7","8","9"],["10","J","Q"],["K","RANDOM","JOKER"]];
const suits={"‚ô£":{symbol:"‚ô£",color:"black"},"‚ô•":{symbol:"‚ô•",color:"red"},"‚ô†":{symbol:"‚ô†",color:"black"},"‚ô¶":{symbol:"‚ô¶",color:"red"}};

let currentCard=null;   
let revealCard=null;    
let chosenValue=null;
let chosenSuit=suits["‚ô•"]; // default Hearts
let faceUp=false;

const card=document.getElementById("card");
const front=document.getElementById("front");
const cardArea=document.getElementById("card-area");

// Modal setup
const modal=document.getElementById("modal");
const valueContainer=document.getElementById("value-buttons");
const suitContainer=document.getElementById("suit-buttons");

// Value buttons
const values=["A","2","3","4","5","6","7","8","9","10","J","Q","K","JOKER"];
values.forEach(v=>{
  const b=document.createElement("button");
  b.textContent=v;
  b.onclick=()=>{
    chosenValue=v;
    document.querySelectorAll("#value-buttons button").forEach(btn=>btn.classList.remove("selected"));
    b.classList.add("selected");
  };
  valueContainer.appendChild(b);
});

// Suit buttons
const suitSymbols=["‚ô£","‚ô•","‚ô†","‚ô¶"];
suitSymbols.forEach(s=>{
  const b=document.createElement("button");
  b.textContent=s;
  b.onclick=()=>{
    chosenSuit=suits[s];
    document.querySelectorAll("#suit-buttons button").forEach(btn=>btn.classList.remove("selected"));
    b.classList.add("selected");
  };
  if(s==="‚ô•") b.classList.add("selected");
  suitContainer.appendChild(b);
});

// Modal functions
document.getElementById("chooseBtn").onclick=()=>modal.classList.add("active");
document.getElementById("doneBtn").onclick=()=>{
  if(chosenValue){
    if(chosenValue==="JOKER") currentCard={label:"üÉè",color:"black"};
    else currentCard={label:chosenValue+chosenSuit.symbol,color:chosenSuit.color};
    revealCard=currentCard;
    faceUp=false;
    updateCard();
    modal.classList.remove("active");
  }
}

// Shuffle button
document.getElementById("shuffleBtn").onclick=()=>{ 
  const allValues=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
  const value=allValues[Math.floor(Math.random()*allValues.length)];
  const suitKeys=Object.keys(suits);
  const suit=suits[suitKeys[Math.floor(Math.random()*suitKeys.length)]];
  revealCard={label:value+suit.symbol,color:suit.color};
  faceUp=false;
  updateCard();
};

// Secret drag/mouse suit override (only triggers outside card)
cardArea.addEventListener("touchstart", e => { const t=e.touches[0]; startX=t.clientX; startY=t.clientY; });
cardArea.addEventListener("touchend", e => { 
  const t = e.changedTouches[0]; 
  if(!e.target.closest("#card")) handleDragOrClick(t.clientX, t.clientY);
});
cardArea.addEventListener("mousedown", e => { 
  if(!e.target.closest("#card")) handleDragOrClick(e.clientX, e.clientY);
});

function handleDragOrClick(x, y){
  const rect = cardArea.getBoundingClientRect();
  const dx = x - (rect.left + rect.width/2);
  const dy = y - (rect.top + rect.height/2);

  if(Math.abs(dx) > Math.abs(dy)) chosenSuit = dx>0 ? suits["‚ô•"] : suits["‚ô¶"];
  else chosenSuit = dy<0 ? suits["‚ô£"] : suits["‚ô†"];

  // Update modal highlighting
  document.querySelectorAll("#suit-buttons button").forEach(btn=>btn.classList.remove("selected"));
  for(const s in suits){
    if(suits[s]===chosenSuit){
      document.querySelectorAll("#suit-buttons button").forEach(btn=>{ if(btn.textContent===s) btn.classList.add("selected"); });
    }
  }
}

// Tap card to flip (value selection)
card.addEventListener("click", e=>{
  if(faceUp){ faceUp=false; updateCard(); return; }
  const rect=card.getBoundingClientRect();
  const x=e.clientX-rect.left;
  const y=e.clientY-rect.top;
  const col=Math.floor(x/(rect.width/3));
  const row=Math.floor(y/(rect.height/5));
  let value=valueGrid[row]?.[col];
  if(!value) return;

  if(value==="RANDOM"){
    if(!revealCard) return;
    currentCard=revealCard;
  } else if(value==="JOKER"){ currentCard={label:"üÉè",color:"black"}; }
  else currentCard={label:value+chosenSuit.symbol,color:chosenSuit.color};

  faceUp=true;
  updateCard();
});

// Update display
function updateCard(){
  if(faceUp && currentCard){
    front.textContent=currentCard.label;
    front.className="card-face front "+(currentCard.color==="red"?"red":"");
  } else front.textContent="";
  card.classList.toggle("face-up",faceUp);
}
</script>
</body>
</html>
