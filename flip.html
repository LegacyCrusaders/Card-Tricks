<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Card App</title>

<style>
body {
  margin:0;
  background:black;
  font-family:system-ui,-apple-system;
  height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  touch-action:none;
}

.scene {
  width:70vw;
  max-width:200px;
  aspect-ratio:7/10;
  perspective:900px;
  margin:30px;
  padding:20px; /* subtle padding for nudges */
  box-sizing:border-box;
}

.card {
  width:100%;
  height:100%;
  position:relative;
  transform-style:preserve-3d;
  transition: transform 0.55s ease;
  border-radius:14px;
}

.card.face-up {
  transform: rotateY(180deg);
}

.card-face {
  position:absolute;
  inset:0;
  border-radius:14px;
  backface-visibility:hidden;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:3rem;
  border:2px solid #222;
}

.front {
  background:white;
  color:black;
  transform:rotateY(180deg);
}

.front.red { color:#b91c1c; }

.back {
  background:
    repeating-linear-gradient(
      45deg,
      #999,#999 10px,
      #b91c1c 10px,#b91c1c 20px
    );
}

.controls {
  display:flex;
  gap:12px;
  margin-top:12px;
}

button {
  background:#111;
  color:white;
  border:1px solid #333;
  padding:10px 14px;
  border-radius:10px;
  font-size:16px;
}

.modal {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.8);
  display:none;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  z-index:10;
}

.modal.active { display:flex; }

.modal .btn-row {
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:6px;
  margin:6px 0;
}

.modal button {
  flex:1 1 18%;
  min-width:40px;
}
</style>
</head>
<body>

<div class="scene">
  <div id="card" class="card">
    <div id="front" class="card-face front"></div>
    <div class="card-face back"></div>
  </div>
</div>

<div class="controls">
  <button onclick="shuffleCard()">Shuffle</button>
  <button onclick="showModal()">Choose</button>
</div>

<div id="modal" class="modal">
  <div class="btn-row" id="value-buttons"></div>
  <div class="btn-row" id="suit-buttons"></div>
  <button onclick="closeModal()">Done</button>
</div>

<script>
/* Wake Lock */
if("wakeLock" in navigator) navigator.wakeLock.request("screen").catch(()=>{});

/* Card setup */
const valueGrid=[
  ["A","2","3"],
  ["4","5","6"],
  ["7","8","9"],
  ["10","J","Q"],
  ["K","RANDOM","JOKER"]
];

const suits={
  "‚ô£":{symbol:"‚ô£",color:"black"},
  "‚ô•":{symbol:"‚ô•",color:"red"},
  "‚ô†":{symbol:"‚ô†",color:"black"},
  "‚ô¶":{symbol:"‚ô¶",color:"red"}
};

let currentCard=null;
let chosenSuit=suits["‚ô•"]; // default Hearts
let faceUp=false;

let startX=0,startY=0,suitLocked=false;

const card=document.getElementById("card");
const front=document.getElementById("front");

/* Modal setup */
const modal=document.getElementById("modal");
const valueContainer=document.getElementById("value-buttons");
const suitContainer=document.getElementById("suit-buttons");

/* Value buttons */
const values=["A","2","3","4","5","6","7","8","9","10","J","Q","K","JOKER"];
values.forEach(v=>{
  const b=document.createElement("button");
  b.textContent=v;
  b.onclick=()=>selectValue(v);
  valueContainer.appendChild(b);
});

/* Suit buttons */
const suitSymbols=["‚ô£","‚ô•","‚ô†","‚ô¶"];
suitSymbols.forEach(s=>{
  const b=document.createElement("button");
  b.textContent=s;
  b.onclick=()=>{ chosenSuit=suits[s]; suitLocked=true; };
  suitContainer.appendChild(b);
});

function showModal(){ modal.classList.add("active"); }
function closeModal(){ modal.classList.remove("active"); }

/* Select value from modal */
function selectValue(val){
  if(val==="JOKER") currentCard={label:"üÉè", color:"black"};
  else currentCard={label:val+chosenSuit.symbol,color:chosenSuit.color};
  faceUp=false;
  updateCard();
}

/* Shuffle */
function shuffleCard(){
  const allValues=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
  const value=allValues[Math.floor(Math.random()*allValues.length)];
  const suitKeys=Object.keys(suits);
  const suit=suits[suitKeys[Math.floor(Math.random()*suitKeys.length)]];
  currentCard={label:value+suit.symbol,color:suit.color};
  faceUp=false;
  updateCard();
}

/* Drag anywhere to override suit */
document.body.addEventListener("touchstart",e=>{
  const t=e.touches[0]; startX=t.clientX; startY=t.clientY;
});
document.body.addEventListener("touchend",e=>{
  if(suitLocked) return;
  const t=e.changedTouches[0];
  const dx=t.clientX-startX;
  const dy=t.clientY-startY;
  if(Math.abs(dx)<20 && Math.abs(dy)<20) return;
  if(Math.abs(dx)>Math.abs(dy)) chosenSuit=dx>0?suits["‚ô•"]:suits["‚ô¶"];
  else chosenSuit=dy<0?suits["‚ô£"]:suits["‚ô†"];
  suitLocked=true;
});

/* Tap card to flip; Random zone reveals currentCard */
card.addEventListener("click",e=>{
  if(faceUp){ faceUp=false; updateCard(); return; }
  const rect=card.getBoundingClientRect();
  const x=e.clientX-rect.left;
  const y=e.clientY-rect.top;
  const col=Math.floor(x/(rect.width/3));
  const row=Math.floor(y/(rect.height/5));
  let value=valueGrid[row]?.[col];
  if(!value) return;
  if(value==="RANDOM"){ if(!currentCard) return; }
  else if(value==="JOKER"){ currentCard={label:"üÉè",color:"black"}; }
  else{ currentCard={label:value+chosenSuit.symbol,color:chosenSuit.color}; }
  faceUp=true; updateCard();
});

/* Update card display */
function updateCard(){
  if(faceUp && currentCard){
    front.textContent=currentCard.label;
    front.className="card-face front "+(currentCard.color==="red"?"red":"");
  } else front.textContent="";
  card.classList.toggle("face-up",faceUp);
}
</script>
</body>
</html>
