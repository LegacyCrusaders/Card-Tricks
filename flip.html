<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Card App</title>

<style>
  body {
    margin: 0;
    background: black;
    color: white;
    font-family: system-ui, -apple-system;
    height: 100vh;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    touch-action: none;
  }

  .app {
    width: 100%;
    max-width: 390px;
    text-align: center;
  }

  .scene {
    width: 65vw;
    max-width: 190px;
    aspect-ratio: 7 / 10;
    perspective: 900px;
    margin: 30px auto;
  }

  .card {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.55s ease;
  }

  .card.face-up {
    transform: rotateY(180deg);
  }

  .card-face {
    position: absolute;
    inset: 0;
    border-radius: 14px;
    backface-visibility: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 3rem;
    border: 2px solid #222;
  }

  .front {
    background: white;
    color: black;
    transform: rotateY(180deg);
  }

  .front.red {
    color: #b91c1c;
  }

  .back {
    background:
      repeating-linear-gradient(
        45deg,
        #999,
        #999 10px,
        #b91c1c 10px,
        #b91c1c 20px
      );
  }

  .controls {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-top: 12px;
  }

  button {
    background: #111;
    color: white;
    border: 1px solid #333;
    padding: 10px 14px;
    border-radius: 10px;
    font-size: 16px;
  }
</style>
</head>
<body>

<div class="app">
  <div class="scene">
    <div id="card" class="card">
      <div id="front" class="card-face front"></div>
      <div class="card-face back"></div>
    </div>
  </div>

  <div class="controls">
    <button onclick="shuffleCard()">Shuffle</button>
    <button onclick="chooseCard()">Choose</button>
  </div>
</div>

<script>
/* Wake Lock */
if ("wakeLock" in navigator) {
  navigator.wakeLock.request("screen").catch(()=>{});
}

/* Value Grid */
const valueGrid = [
  ["A","2","3"],
  ["4","5","6"],
  ["7","8","9"],
  ["10","J","Q"],
  ["K","RANDOM","JOKER"]
];

/* Suits mapped to drag directions */
const suits = {
  up:    { symbol:"‚ô£", color:"black" },
  right: { symbol:"‚ô•", color:"red"   },
  down:  { symbol:"‚ô†", color:"black" },
  left:  { symbol:"‚ô¶", color:"red"   }
};

let currentCard = null; // set by shuffle or choose
let chosenSuit = null;  // set by drag
let faceUp = false;

let startX=0, startY=0, suitLocked=false;

const card = document.getElementById("card");
const front = document.getElementById("front");

/* Track drag for suit */
document.body.addEventListener("touchstart", e=>{
  const t = e.touches[0];
  startX = t.clientX;
  startY = t.clientY;
});

document.body.addEventListener("touchend", e=>{
  if (suitLocked) return;

  const t = e.changedTouches[0];
  const dx = t.clientX - startX;
  const dy = t.clientY - startY;

  if (Math.abs(dx)<20 && Math.abs(dy)<20) return; // too small, ignore

  if (Math.abs(dx)>Math.abs(dy)) chosenSuit = dx>0?suits.right:suits.left;
  else chosenSuit = dy<0?suits.up:suits.down;

  suitLocked = true;
});

/* Shuffle assigns a random card (for RANDOM tap zone) */
function shuffleCard(){
  const allValues = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
  const value = allValues[Math.floor(Math.random()*allValues.length)];
  const suitKeys = Object.keys(suits);
  const suit = suits[suitKeys[Math.floor(Math.random()*suitKeys.length)]];
  currentCard = { label:value+suit.symbol, color:suit.color };
  faceUp=false;
  updateCard();
}

/* Choose menu (simplified prompt version for demonstration) */
function chooseCard(){
  const val = prompt("Enter value (A-10,J,Q,K,JOKER):");
  if(!val) return;
  let chosenVal = val.toUpperCase();

  if(chosenVal === "JOKER") currentCard={label:"üÉè", color:"black"};
  else {
    let suitPrompt = prompt("Enter suit (‚ô†,‚ô•,‚ô¶,‚ô£) or leave blank:");
    let suitObj = Object.values(suits).find(s=>s.symbol===suitPrompt);
    if(!suitObj) suitObj = {symbol:"‚ô†", color:"black"}; // default
    currentCard={label:chosenVal+suitObj.symbol, color:suitObj.color};
  }

  faceUp=false;
  updateCard();
}

/* Tap card to select value and flip */
card.addEventListener("click", e=>{
  if(faceUp){
    faceUp=false;
    updateCard();
    return;
  }

  const rect = card.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  const col = Math.floor(x / (rect.width/3));
  const row = Math.floor(y / (rect.height/5));
  let value = valueGrid[row]?.[col];
  if(!value) return;

  if(value==="RANDOM"){
    if(!currentCard) return; // no card set yet
    // just reveal whatever card is currently set (shuffle or choose)
  } else if(value==="JOKER"){
    currentCard={label:"üÉè", color:"black"};
  } else {
    if(!chosenSuit) return; // must drag first to set suit
    currentCard={label:value+chosenSuit.symbol, color:chosenSuit.color};
  }

  faceUp=true;
  updateCard();
});

/* Render card */
function updateCard(){
  if(faceUp && currentCard){
    front.textContent = currentCard.label;
    front.className = "card-face front "+(currentCard.color==="red"?"red":"");
  } else front.textContent="";
  card.classList.toggle("face-up", faceUp);
}
</script>
</body>
</html>
