<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Card App</title>

<style>
  body {
    margin: 0;
    background: black;
    color: white;
    font-family: system-ui, -apple-system;
    height: 100vh;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    touch-action: none;
    flex-direction: column;
  }

  .scene {
    width: 65vw;
    max-width: 190px;
    aspect-ratio: 7 / 10;
    perspective: 900px;
    margin: 20px auto;
  }

  .card {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.55s ease;
    border-radius: 14px;
  }

  .card.face-up {
    transform: rotateY(180deg);
  }

  .card-face {
    position: absolute;
    inset: 0;
    border-radius: 14px;
    backface-visibility: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 3rem;
    border: 2px solid #222;
  }

  .front {
    background: white;
    color: black;
    transform: rotateY(180deg);
  }

  .front.red {
    color: #b91c1c;
  }

  .back {
    background:
      repeating-linear-gradient(
        45deg,
        #999,
        #999 10px,
        #b91c1c 10px,
        #b91c1c 20px
      );
  }

  .controls {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 10px;
    width: 95%;
    max-width: 380px;
  }

  .btn-row {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 6px;
  }

  button {
    background: #111;
    color: white;
    border: 1px solid #333;
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 16px;
    flex: 1 1 20%;
    min-width: 40px;
  }
</style>
</head>
<body>

<div class="scene">
  <div id="card" class="card">
    <div id="front" class="card-face front"></div>
    <div class="card-face back"></div>
  </div>
</div>

<div class="controls">
  <div class="btn-row" id="value-buttons"></div>
  <div class="btn-row" id="suit-buttons"></div>
  <div class="btn-row">
    <button onclick="shuffleCard()">Shuffle</button>
  </div>
</div>

<script>
/* Wake Lock */
if ("wakeLock" in navigator) navigator.wakeLock.request("screen").catch(()=>{});

/* Card grid mapping for tap zones */
const valueGrid = [
  ["A","2","3"],
  ["4","5","6"],
  ["7","8","9"],
  ["10","J","Q"],
  ["K","RANDOM","JOKER"]
];

/* Suits mapping */
const suits = {
  "‚ô£": {symbol:"‚ô£", color:"black"},
  "‚ô•": {symbol:"‚ô•", color:"red"},
  "‚ô†": {symbol:"‚ô†", color:"black"},
  "‚ô¶": {symbol:"‚ô¶", color:"red"}
};

let currentCard = null;       // The card to reveal (from shuffle or choose)
let chosenSuit = suits["‚ô•"];  // Default to Hearts
let faceUp = false;

let startX=0, startY=0, suitLocked=false;

const card = document.getElementById("card");
const front = document.getElementById("front");

/* Create value buttons A-K + Joker */
const valueContainer = document.getElementById("value-buttons");
const values = ["A","2","3","4","5","6","7","8","9","10","J","Q","K","JOKER"];
values.forEach(v=>{
  const b = document.createElement("button");
  b.textContent = v;
  b.onclick = ()=>selectValue(v);
  valueContainer.appendChild(b);
});

/* Create suit buttons C/H/S/D */
const suitContainer = document.getElementById("suit-buttons");
const suitSymbols = ["‚ô£","‚ô•","‚ô†","‚ô¶"];
suitSymbols.forEach(s=>{
  const b = document.createElement("button");
  b.textContent = s;
  b.onclick = ()=>{ chosenSuit = suits[s]; suitLocked=true; };
  suitContainer.appendChild(b);
});

/* Select value from buttons (sets currentCard, flips) */
function selectValue(val){
  if(val==="JOKER") currentCard={label:"üÉè", color:"black"};
  else{
    currentCard={label:val+chosenSuit.symbol, color:chosenSuit.color};
  }
  faceUp=true;
  updateCard();
}

/* Shuffle assigns a random card for Random zone */
function shuffleCard(){
  const allValues = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
  const value = allValues[Math.floor(Math.random()*allValues.length)];
  const suitKeys = Object.keys(suits);
  const suit = suits[suitKeys[Math.floor(Math.random()*suitKeys.length)]];
  currentCard = { label:value+suit.symbol, color:suit.color };
  faceUp=false;
  updateCard();
}

/* Drag anywhere to override suit */
document.body.addEventListener("touchstart", e=>{
  const t = e.touches[0];
  startX = t.clientX;
  startY = t.clientY;
});

document.body.addEventListener("touchend", e=>{
  if (suitLocked) return;

  const t = e.changedTouches[0];
  const dx = t.clientX - startX;
  const dy = t.clientY - startY;
  if(Math.abs(dx)<20 && Math.abs(dy)<20) return;

  if(Math.abs(dx)>Math.abs(dy)) chosenSuit = dx>0?suits["‚ô•"]:suits["‚ô¶"];
  else chosenSuit = dy<0?suits["‚ô£"]:suits["‚ô†"];
  suitLocked=true;
});

/* Tap card to flip. Random zone shows currentCard. */
card.addEventListener("click", e=>{
  if(faceUp){ faceUp=false; updateCard(); return; }

  const rect = card.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  const col = Math.floor(x/(rect.width/3));
  const row = Math.floor(y/(rect.height/5));

  let value = valueGrid[row]?.[col];
  if(!value) return;

  if(value==="RANDOM"){
    if(!currentCard) return; // nothing to reveal
  } else if(value==="JOKER"){
    currentCard={label:"üÉè", color:"black"};
  } else {
    currentCard={label:value+chosenSuit.symbol, color:chosenSuit.color};
  }

  faceUp=true;
  updateCard();
});

/* Render card */
function updateCard(){
  if(faceUp && currentCard){
    front.textContent = currentCard.label;
    front.className = "card-face front "+(currentCard.color==="red"?"red":"");
  } else front.textContent="";
  card.classList.toggle("face-up", faceUp);
}
</script>
</body>
</html>
