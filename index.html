<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pick a Card & Number</title>
  <style>
    body {
      background-color: black;
      color: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      margin-top: 50px;
    }
    h1 {
      margin-bottom: 10px;
      cursor: pointer;
      user-select: none;
    }
    button {
      font-size: 18px;
      margin: 10px;
      padding: 10px 20px;
      background-color: white;
      color: black;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #card-display {
      font-size: 140px;
      margin: 10px 0;
      display: inline-flex;
      gap: 10px;
    }
    #card-rank, #card-suit {
      line-height: 1;
      user-select: none;
    }
    #number-display, #hit-count, #miss-count {
      font-size: 28px;
      margin: 15px 0;
    }
    .button-row {
      display: flex;
      justify-content: center;
      gap: 20px;
    }
    #stack-display {
      margin-top: 20px;
      white-space: pre-wrap;
      font-size: 14px;
      display: none;
    }
  </style>
</head>
<body>
  <h1 id="title">Pick a Card & Number</h1>
  <div id="card-display"><div id="card-rank">A</div><div id="card-suit">♠</div></div>
  <button onclick="buttonPressed('card')">Random Card</button>
  <div id="number-display">Number: (loading...)</div>
  <button onclick="buttonPressed('number')">Random Number</button>
  <button onclick="buttonPressed('both')">Random Both</button>

  <div class="button-row">
    <div>
      <div id="hit-count">Hits: 3</div>
      <button onclick="recordHit()">Hit</button>
    </div>
    <div>
      <div id="miss-count">Misses: 68</div>
      <button onclick="recordMiss()">Miss</button>
    </div>
  </div>

  <pre id="stack-display"></pre>

  <script>
    let stack = [
      '4 of Clubs', '7 of Hearts', 'King of Diamonds', '9 of Spades', '2 of Clubs', 'Jack of Hearts', '5 of Diamonds', 'Ace of Spades',
      '10 of Clubs', '3 of Hearts', '6 of Spades', 'Queen of Clubs', '8 of Diamonds', 'King of Clubs', '2 of Diamonds', '4 of Hearts',
      'Ace of Clubs', '7 of Spades', '3 of Diamonds', '9 of Clubs', '5 of Hearts', 'Jack of Spades', '6 of Diamonds', 'Queen of Hearts',
      '8 of Clubs', 'King of Spades', '2 of Spades', '4 of Diamonds', 'Ace of Hearts', '7 of Clubs', '3 of Spades', '9 of Hearts',
      '5 of Spades', 'Jack of Diamonds', '6 of Clubs', 'Queen of Spades', '8 of Hearts', 'King of Hearts', '2 of Hearts', '4 of Spades',
      'Ace of Diamonds', '7 of Diamonds', '3 of Clubs', '9 of Diamonds', '5 of Clubs', 'Jack of Clubs', '6 of Hearts', 'Queen of Diamonds',
      '8 of Spades', '10 of Diamonds', '10 of Hearts', '10 of Spades'
    ];

    let currentCard = null;
    let currentNumber = null;
    let hitCount = 3;
    let missCount = 68;
    let lastPresses = [];
    let clickCount = 0;
    let clickTimer = null;

    const suits = {
      Spades: '♠',
      Clubs: '♣',
      Hearts: '♥',
      Diamonds: '♦'
    };

    const suitColors = {
      Spades: 'white',
      Clubs: 'white',
      Hearts: 'red',
      Diamonds: 'red'
    };

    function parseCard(card) {
      const [rank, , suit] = card.split(' ');
      return { rank, suit };
    }

    function displayCard(cardStr) {
      const { rank, suit } = parseCard(cardStr);
      document.getElementById('card-rank').textContent = rank === '10' ? '10' : rank[0];
      document.getElementById('card-suit').textContent = suits[suit];
      document.getElementById('card-suit').style.color = suitColors[suit];
    }

    function numberToCard(n) {
      return stack[n - 1];
    }

    function cardToNumber(card) {
      return stack.indexOf(card) + 1;
    }

    function updatePressHistory(type) {
      lastPresses.push(type);
      if (lastPresses.length > 3) lastPresses.shift();
    }

    function showCard() {
      if (lastPresses.at(-1) === 'number' && currentNumber !== null) {
        currentCard = numberToCard(currentNumber);
      } else {
        const idx = Math.floor(Math.random() * 52);
        currentCard = stack[idx];
      }
      displayCard(currentCard);
      updatePressHistory('card');
    }

    function showNumber() {
      if (lastPresses.at(-1) === 'card' && currentCard !== null) {
        currentNumber = cardToNumber(currentCard);
      } else {
        currentNumber = Math.floor(Math.random() * 52) + 1;
      }
      document.getElementById('number-display').textContent = `Number: ${currentNumber}`;
      updatePressHistory('number');
    }

    function showBoth() {
      const numberDisplay = document.getElementById('number-display');
      const last3 = lastPresses.slice(-3);
      const matchSeq = last3.join(',') === 'card,number,both';
      if (matchSeq && currentNumber !== null) {
        currentCard = numberToCard(currentNumber);
      } else {
        currentNumber = Math.floor(Math.random() * 52) + 1;
        let newCard;
        do {
          const idx = Math.floor(Math.random() * 52);
          newCard = stack[idx];
        } while (cardToNumber(newCard) === currentNumber);
        currentCard = newCard;
      }
      numberDisplay.textContent = `Number: ${currentNumber}`;
      displayCard(currentCard);
      updatePressHistory('both');
    }

    function buttonPressed(type) {
      hideStackIfVisible();
      if (type === 'card') showCard();
      else if (type === 'number') showNumber();
      else if (type === 'both') showBoth();
    }

    function recordHit() {
      hitCount++;
      document.getElementById('hit-count').textContent = `Hits: ${hitCount}`;
      if (currentCard) {
        const idx = cardToNumber(currentCard) - 1;
        stack = [...stack.slice(idx + 1), ...stack.slice(0, idx + 1)];
      }
    }

    function recordMiss() {
      missCount++;
      document.getElementById('miss-count').textContent = `Misses: ${missCount}`;
    }

    function hideStackIfVisible() {
      const stackDiv = document.getElementById('stack-display');
      if (stackDiv.style.display === 'block') {
        stackDiv.style.display = 'none';
      }
    }

    document.getElementById('title').addEventListener('click', () => {
      const stackDiv = document.getElementById('stack-display');
      if (stackDiv.style.display === 'block') {
        stackDiv.style.display = 'none';
        clickCount = 0;
        if (clickTimer) clearTimeout(clickTimer);
        return;
      }
      clickCount++;
      if (clickTimer) clearTimeout(clickTimer);
      clickTimer = setTimeout(() => {
        clickCount = 0;
      }, 1000);
      if (clickCount === 3) {
        clickCount = 0;
        stackDiv.textContent = stack.map((c, i) => `${i + 1}: ${c}`).join('\n');
        stackDiv.style.display = 'block';
      }
    });

    window.onload = () => {
      currentNumber = Math.floor(Math.random() * 52) + 1;
      currentCard = numberToCard(currentNumber);
      document.getElementById('number-display').textContent = `Number: ${currentNumber}`;
      displayCard(currentCard);
    };
  </script>
</body>
</html>
