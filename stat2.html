<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Running Card Choice Statistics</title>

<style>
body{font-family:Arial,sans-serif;max-width:460px;margin:20px auto;padding:20px;border:2px solid #333;border-radius:8px;background:#f9f9f9;user-select:none}
h1{text-align:center;margin:0 0 8px}
#description{text-align:center;font-size:14px;color:#555;margin-bottom:12px;font-style:italic}
.input-area{display:flex;gap:16px;align-items:center;justify-content:space-between}
.controls{display:flex;gap:8px}
select,button{padding:8px;font-size:16px}
button{cursor:pointer;background:#007bff;color:#fff;border:none;border-radius:4px}
.card-display{font-size:80px;font-weight:bold;cursor:pointer}
.red{color:red}
.black{color:black}
#result{text-align:center;font-size:20px;font-weight:bold;margin-top:20px}
</style>
</head>

<body>

<h1>Running Card Choice Statistics</h1>
<div id="description">Live probability analysis of named card and number combinations.</div>

<div class="input-area">
  <div>
    <div class="controls">
      <select id="numberSelect"></select>
      <button id="randomNumber">Randomize</button>
    </div>
    <div class="controls" style="margin-top:10px">
      <select id="cardSelect"></select>
      <button id="randomCard">Randomize</button>
    </div>
  </div>
  <div id="cardDisplay" class="card-display black">A♠</div>
</div>

<button id="submitBtn" style="width:100%;margin-top:20px">Submit</button>
<div id="result">Make a selection.</div>

<script>
const SHEET_URL='https://script.google.com/macros/s/AKfycby3IIZk26_giu6v6EEO42QA2ogTFPE1S3oboRRhTDb2_ZjWDjL4UuhRGL20WtGgoNOukA/exec';

const values=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
const suits=['♣','♥','♠','♦'];

const siStebbins=[];
for(let s of suits){for(let v of values){siStebbins.push(v+s)}}

let lastChoice=null;
let stats={};

const cardSelect=document.getElementById('cardSelect');
const numberSelect=document.getElementById('numberSelect');
const cardDisplay=document.getElementById('cardDisplay');
const result=document.getElementById('result');

function send(card,number){
fetch(SHEET_URL,{method:'POST',mode:'no-cors',headers:{'Content-Type':'application/json'},body:JSON.stringify({card,number})});
}

function updateCard(card){
cardDisplay.textContent=card;
cardDisplay.className='card-display '+(card.includes('♥')||card.includes('♦')?'red':'black');
}

function likelihood(card,number,forced=false){
if(forced)return (Math.random()*0.04+0.01).toFixed(2);
const k=card+'-'+number;
if(!stats[k])stats[k]=(1+Math.random()*4).toFixed(2);
return stats[k];
}

function forcedNumber(card){
let i=siStebbins.indexOf(card);
return ((i+52-13)%52)+1;
}

function forcedCard(number){
return siStebbins[(number+13-1)%52];
}

function update(){
let card=cardSelect.value;
let number=+numberSelect.value;
let forced=false;

if(lastChoice==='card'){
number=forcedNumber(card);
numberSelect.value=number;
forced=true;
}
if(lastChoice==='number'){
card=forcedCard(number);
cardSelect.value=card;
updateCard(card);
forced=true;
}

const p=likelihood(card,number,forced);
result.textContent=`Chosen ${p}% of the time.`;
send(card,number);
}

for(let i=1;i<=52;i++){numberSelect.add(new Option(i,i))}
for(let c of siStebbins){cardSelect.add(new Option(c,c))}

cardSelect.onchange=()=>{lastChoice='card';updateCard(cardSelect.value);update();}
numberSelect.onchange=()=>{lastChoice='number';update();}

document.getElementById('randomCard').onclick=()=>{
const c=siStebbins[Math.floor(Math.random()*52)];
cardSelect.value=c;
lastChoice='card';
updateCard(c);
update();
};

document.getElementById('randomNumber').onclick=()=>{
numberSelect.value=Math.floor(Math.random()*52)+1;
lastChoice='number';
update();
};

cardDisplay.onclick=()=>{
lastChoice='card';
document.getElementById('randomCard').click();
};

document.getElementById('submitBtn').onclick=()=>update();

cardSelect.value='A♠';
numberSelect.value=1;
updateCard('A♠');
update();
</script>

</body>
</html>
